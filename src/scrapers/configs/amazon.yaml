name: "amazon"
test_skus: ["035585499741"]
base_url: "https://www.amazon.com"
timeout: 120
retries: 10

selectors:
  - name: "Name"
    selector: "#productTitle"
    attribute: "text"
  - name: "Brand"
    selector: "#bylineInfo"
    attribute: "text"
  - name: "Images"
    selector: "#altImages li.imageThumbnail img"
    attribute: "src"
    multiple: true
  - name: "Weight"
    selector: "//tr[.//th[contains(., 'Weight')]] | //li[contains(., 'ounces')] | //li[contains(., 'pounds')]"
    attribute: "text"

workflows:
  - action: "conditional_click"
    params:
      selector: "#sp-cc-accept"
  - action: "navigate"
    params:
      url: "https://www.amazon.com/s?k={sku}"
  - action: "wait_for"
    params:
      selector: ".s-result-item, .s-no-results, #no-results, .s-search-no-results, #noResultsTitle"
      timeout: 30
  - action: "check_no_results" # Check for no results after page load
    params:
      min_confidence: 0.8
  - action: "conditional_skip"
    params:
      if_flag: "no_results_found"
  - action: "click"
    params:
      selector: ".s-result-item a[href*='/dp/'], .s-search-result a[href*='/dp/']"
      filter_text_exclude: "sponsored"
      index: 0
  - action: "wait_for"
    params:
      selector: "#productTitle, #title, h1"
      timeout: 30
  - action: "extract"
    params:
      fields: ["Name", "Brand", "Images", "Weight"]

anti_detection:
  enable_captcha_detection: true
  enable_rate_limiting: false
  enable_human_simulation: true
  enable_session_rotation: false
  enable_blocking_handling: true
  captcha_selectors:
    - "[class*='captcha']"
    - "[id*='captcha']"
    - "[class*='recaptcha']"
    - "[id*='recaptcha']"
    - ".g-recaptcha"
    - "#captcha-container"
  blocking_selectors:
    - "[class*='blocked']"
    - "[id*='blocked']"
    - "[class*='banned']"
    - "[id*='banned']"
    - "[class*='access-denied']"
    - "[id*='access-denied']"
  rate_limit_min_delay: 20.0
  rate_limit_max_delay: 60.0
  session_rotation_interval: 100
  max_retries_on_detection: 5

validation:
  no_results_selectors:
    - ".no-results"
    - ".empty-search"
    - "[data-testid*='no-results']"
    - ".s-no-results"
    - "#no-results"
    - "#noResultsTitle"
    - ".no-results-message"
    - "div.s-search-results > div[data-component-type='s-search-result']:first-child:not([data-component-id])"
    - ".s-search-results .s-result-item .s-title-instructions-style h2:contains('No results for')"
    - "//h2[contains(text(), 'No results for')]"
  no_results_text_patterns:
    - "no results found"
    - "no products found"
    - "your search returned no results"
    - "we couldn't find any results"
    - "no items match your search"
    - "no results for"
    - "your search did not yield any results"
    - "we cannot find any results for"
    - "try checking your spelling or use more general terms"
    - "didn't find any results"
    - "zero results"
    - "More results"
